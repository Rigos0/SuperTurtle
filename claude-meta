#!/usr/bin/env bash
set -euo pipefail

if [[ ! -f "AGENTS.md" ]]; then
  echo "[claude-meta] error: run this from the /agentic repo root (AGENTS.md not found)." >&2
  echo "[claude-meta] hint: cd /agentic && ./claude-meta" >&2
  exit 1
fi

prompt_file="${META_PROMPT_FILE:-meta/META_SHARED.md}"
if [[ ! -f "$prompt_file" ]]; then
  echo "[claude-meta] error: meta prompt file not found: $prompt_file" >&2
  exit 1
fi

if [[ ! -s "$prompt_file" ]]; then
  echo "[claude-meta] error: meta prompt file is empty: $prompt_file" >&2
  exit 1
fi

meta_text="$(cat "$prompt_file")"
meta_len="${#meta_text}"

echo "[claude-meta] cwd: $(pwd)" >&2
echo "[claude-meta] meta prompt: $prompt_file (${meta_len} chars)" >&2

exec claude --dangerously-skip-permissions --append-system-prompt "$meta_text" "$@"
